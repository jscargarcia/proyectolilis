{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Lilis System</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% static 'img/logo.svg' %}">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <!-- Custom Login CSS -->
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
    
    <style>
        .password-strength {
            height: 4px;
            border-radius: 2px;
            margin-top: 5px;
            transition: all 0.3s ease;
            background: #e5e7eb;
        }
        .password-strength.weak {
            background: linear-gradient(to right, #ef4444 33%, #e5e7eb 33%);
        }
        .password-strength.medium {
            background: linear-gradient(to right, #f59e0b 66%, #e5e7eb 66%);
        }
        .password-strength.strong {
            background: linear-gradient(to right, #10b981 100%, #e5e7eb 100%);
        }
        
        .password-requirements {
            margin-top: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            font-size: 0.75rem;
        }
        
        .requirement {
            margin: 3px 0;
            color: rgba(255,255,255,0.7);
            transition: color 0.3s ease;
        }
        
        .requirement.valid {
            color: #10b981;
        }
        
        .requirement i {
            width: 15px;
        }
        
        .login-card {
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .section-title {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
            font-weight: 600;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .section-title:first-of-type {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <img src="{% static 'img/logo.svg' %}" alt="Lili's Logo" width="80" height="80" class="mb-3">
                <h3>Dulcería Lili's</h3>
                <p class="mb-0">Crea tu cuenta para comenzar</p>
            </div>
            
            <div class="login-body">
                <form method="post" class="login-form" id="registroForm" novalidate>
                    {% csrf_token %}
                    
                    <!-- Información de Acceso -->
                    <div class="section-title">
                        <i class="fas fa-key me-2"></i>Información de Acceso
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-user"></i>
                        {{ form.username }}
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-envelope"></i>
                        {{ form.email }}
                    </div>
                    
                    <!-- Información Personal -->
                    <div class="section-title">
                        <i class="fas fa-id-card me-2"></i>Información Personal
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-user"></i>
                        {{ form.nombres }}
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-user"></i>
                        {{ form.apellidos }}
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-phone"></i>
                        {{ form.telefono }}
                    </div>
                    
                    <!-- Contraseña y Seguridad -->
                    <div class="section-title">
                        <i class="fas fa-lock me-2"></i>Contraseña y Seguridad
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-lock"></i>
                        {{ form.password1 }}
                        <button type="button" class="password-toggle" onclick="togglePassword('password1')">
                            <i class="fas fa-eye" id="eye-password1"></i>
                        </button>
                    </div>
                    <div class="password-strength" id="strength-bar"></div>
                    <div class="password-requirements" id="password-requirements">
                        <div class="requirement" id="length-req">
                            <i class="fas fa-times-circle"></i> Al menos 8 caracteres
                        </div>
                        <div class="requirement" id="upper-req">
                            <i class="fas fa-times-circle"></i> Una letra mayúscula
                        </div>
                        <div class="requirement" id="lower-req">
                            <i class="fas fa-times-circle"></i> Una letra minúscula
                        </div>
                        <div class="requirement" id="number-req">
                            <i class="fas fa-times-circle"></i> Un número
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <i class="input-icon fas fa-lock"></i>
                        {{ form.password2 }}
                        <button type="button" class="password-toggle" onclick="togglePassword('password2')">
                            <i class="fas fa-eye" id="eye-password2"></i>
                        </button>
                    </div>
                    
                    <div class="form-check mt-3 mb-3" style="color: white;">
                        <input class="form-check-input" type="checkbox" id="terminos" name="terminos" required>
                        <label class="form-check-label" for="terminos" style="font-size: 0.9rem;">
                            Acepto los <a href="#" id="terminosLink" style="color: #fbbf24; text-decoration: underline;">términos y condiciones</a>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn login-btn">
                        <i class="fas fa-user-plus"></i> Crear Cuenta
                    </button>
                </form>
                
                <div class="text-center mt-3">
                    <p class="mb-0" style="font-size: 0.9rem; color: white;">
                        ¿Ya tienes cuenta? 
                        <a href="{% url 'autenticacion:login' %}" style="color: #fbbf24; font-weight: 600;">
                            Inicia sesión aquí
                        </a>
                    </p>
                </div>
            </div>
            
            <div class="login-footer">
                <p class="mb-0">&copy; 2025 Dulcería Lilis - Todos los derechos reservados</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // Mostrar mensajes con SweetAlert2
        {% if messages %}
            {% for message in messages %}
                Swal.fire({
                    icon: '{% if message.tags == "success" %}success{% elif message.tags == "error" or message.tags == "danger" %}error{% elif message.tags == "warning" %}warning{% else %}info{% endif %}',
                    title: '{% if message.tags == "success" %}¡Éxito!{% elif message.tags == "error" or message.tags == "danger" %}Error{% elif message.tags == "warning" %}Advertencia{% else %}Información{% endif %}',
                    text: '{{ message|escapejs }}',
                    confirmButtonColor: '#dc2626'
                });
            {% endfor %}
        {% endif %}
        
        // Toggle password visibility
        function togglePassword(fieldId) {
            const password = document.getElementById(fieldId);
            const icon = document.getElementById('eye-' + fieldId);
            
            if (password.type === 'password') {
                password.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                password.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Password strength indicator
        const password1 = document.getElementById('password1');
        if (password1) {
            password1.addEventListener('input', function() {
                const value = this.value;
                const strengthBar = document.getElementById('strength-bar');
                
                // Check requirements
                const length = value.length >= 8;
                const upper = /[A-Z]/.test(value);
                const lower = /[a-z]/.test(value);
                const number = /[0-9]/.test(value);
                
                // Update requirement indicators
                updateRequirement('length-req', length);
                updateRequirement('upper-req', upper);
                updateRequirement('lower-req', lower);
                updateRequirement('number-req', number);
                
                // Calculate strength
                let strength = 0;
                if (length) strength++;
                if (upper) strength++;
                if (lower) strength++;
                if (number) strength++;
                
                // Update strength bar
                strengthBar.className = 'password-strength';
                if (strength >= 4) {
                    strengthBar.classList.add('strong');
                } else if (strength >= 2) {
                    strengthBar.classList.add('medium');
                } else if (strength >= 1) {
                    strengthBar.classList.add('weak');
                }
            });
        }
        
        function updateRequirement(id, valid) {
            const req = document.getElementById(id);
            const icon = req.querySelector('i');
            
            if (valid) {
                req.classList.add('valid');
                icon.classList.remove('fa-times-circle');
                icon.classList.add('fa-check-circle');
            } else {
                req.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
            }
        }
        
        // Términos y condiciones modal
        document.getElementById('terminosLink')?.addEventListener('click', function(e) {
            e.preventDefault();
            Swal.fire({
                title: 'Términos y Condiciones',
                html: `
                    <div style="text-align: left; max-height: 400px; overflow-y: auto;">
                        <h6>1. Uso del Servicio</h6>
                        <p>Al registrarte, aceptas usar este servicio de manera responsable.</p>
                        
                        <h6>2. Privacidad de Datos</h6>
                        <p>Tus datos personales serán protegidos según nuestra política de privacidad.</p>
                        
                        <h6>3. Seguridad de la Cuenta</h6>
                        <p>Eres responsable de mantener la seguridad de tu contraseña.</p>
                        
                        <h6>4. Conducta del Usuario</h6>
                        <p>No se permite el uso indebido o fraudulento del sistema.</p>
                        
                        <h6>5. Modificaciones</h6>
                        <p>Nos reservamos el derecho de modificar estos términos.</p>
                    </div>
                `,
                confirmButtonText: 'Entendido',
                confirmButtonColor: '#dc2626',
                width: '600px'
            });
        });
        
        // Form validation
        document.getElementById('registroForm')?.addEventListener('submit', function(e) {
            const terminos = document.getElementById('terminos');
            if (!terminos.checked) {
                e.preventDefault();
                Swal.fire({
                    icon: 'warning',
                    title: 'Términos requeridos',
                    text: 'Debes aceptar los términos y condiciones para continuar',
                    confirmButtonColor: '#dc2626'
                });
            }
        });
    </script>
</body>
</html>
