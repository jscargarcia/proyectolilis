{% extends 'base.html' %}
{% load static %}
{% load permisos_tags %}

{% block title %}Dashboard - Lilis System{% endblock %}

{% block extra_css %}
<style>
    /* Fondo de la página completa */
    .dashboard-container {
        background: linear-gradient(135deg, #fff8e1 0%, #fee2e2 30%, #f3e5f5 70%, #fce7f3 100%);
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        min-height: 100vh;
        padding: 20px 0;
    }
    
    /* Overlay sutil para mejorar legibilidad - sin interferencias */
    .dashboard-container::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 248, 240, 0.7);
        z-index: -999;
        pointer-events: none;
    }
    
    /* Asegurar que el contenido esté sobre el overlay */
    .dashboard-container > * {
        position: relative;
        z-index: 1;
    }
    
    /* Asegurar que los dropdowns tengan z-index alto */
    .dropdown-menu {
        z-index: 1050 !important;
        position: absolute !important;
    }
    
    .navbar-nav .dropdown-menu {
        z-index: 1060 !important;
        position: absolute !important;
    }
    
    /* Estilos específicos para el dropdown del navbar en dashboard */
    .navbar .dropdown {
        z-index: 1070 !important;
        position: relative !important;
    }
    
    .navbar .dropdown-menu {
        z-index: 1080 !important;
        position: absolute !important;
        background: white !important;
        border: 1px solid rgba(0,0,0,0.15) !important;
        box-shadow: 0 6px 12px rgba(0,0,0,0.175) !important;
    }
    
    /* Forzar que el navbar tenga prioridad máxima */
    .navbar {
        z-index: 1100 !important;
        position: relative !important;
    }
    
    .navbar-nav {
        z-index: 1101 !important;
        position: relative !important;
    }
    
    /* Específico para el dropdown del usuario */
    .dropdown-menu-end {
        z-index: 1200 !important;
        position: absolute !important;
        background: white !important;
        border: 1px solid rgba(0,0,0,0.15) !important;
        box-shadow: 0 6px 12px rgba(0,0,0,0.175) !important;
        right: 0 !important;
        left: auto !important;
        top: 100% !important;
        transform: none !important;
    }
    
    /* Asegurar que el contenedor del dashboard no interfiera */
    .dashboard-container {
        position: relative;
        z-index: auto;
    }
    
    /* Forzar todos los elementos del navbar a estar siempre encima */
    nav.navbar,
    nav.navbar *,
    .navbar-nav,
    .navbar-nav *,
    .dropdown,
    .dropdown *,
    .dropdown-menu,
    .dropdown-menu * {
        z-index: 9999 !important;
        position: relative !important;
    }
    
    .dropdown-menu {
        position: absolute !important;
    }
    
    /* Tarjetas con fondo semi-transparente */
    .card {
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(220, 38, 38, 0.2);
    }
    
    /* Carrusel con sombra más pronunciada */
    .carousel-inner {
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4) !important;
    }
    
    /* Botón de gestión de productos */
    .alert-info {
        background: rgba(220, 38, 38, 0.95) !important;
        backdrop-filter: blur(10px);
    }
    
    /* Asegurar que todos los elementos interactivos tengan z-index apropiado */
    .btn, .card, .alert, .carousel {
        position: relative;
        z-index: 10;
    }
    
    /* Modales y overlays */
    .modal {
        z-index: 1070 !important;
    }
    
    .modal-backdrop {
        z-index: 1060 !important;
    }
    
    /* Tooltips y popovers */
    .tooltip {
        z-index: 1080 !important;
    }
    
    .popover {
        z-index: 1080 !important;
    }
    
    /* Estilos para tarjetas de módulos - compatibles con modo oscuro y claro */
    .card.h-100 {
        background-color: white !important;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card.h-100:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Títulos y texto de las tarjetas siempre oscuros en fondo blanco */
    .card.h-100 .card-title {
        color: #1f2937 !important;
        font-weight: 600;
    }
    
    .card.h-100 .card-text {
        color: #4b5563 !important;
    }
    
    /* Modo oscuro - las tarjetas se mantienen blancas para buen contraste */
    [data-bs-theme="dark"] .card.h-100 {
        background-color: white !important;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    [data-bs-theme="dark"] .card.h-100 .card-title {
        color: #1f2937 !important;
    }
    
    [data-bs-theme="dark"] .card.h-100 .card-text {
        color: #4b5563 !important;
    }
    
    /* Asegurar que el h4 "Módulos del Sistema" sea visible en ambos modos */
    .text-center h4 {
        color: inherit;
    }
    
    [data-bs-theme="dark"] .text-center h4 {
        color: #e5e7eb !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container" style="position: relative;">
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </h2>
            </div>
        </div>
    
    <!-- Carrusel de Imágenes - Productos Lilis -->
    <div class="row mb-4">
        <div class="col-12">
            <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner" style="border-radius: 15px; overflow: hidden; box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);">
                    <div class="carousel-item active">
                        <img src="{% static 'img/carousel/lilis-productos-1.jpg' %}" class="d-block w-100" alt="Productos Lilis - Galletas y Conitos" style="height: 450px; object-fit: cover;">
                        <div class="carousel-caption d-none d-md-block" style="background: linear-gradient(to top, rgba(220, 38, 38, 0.9), rgba(220, 38, 38, 0.7)); border-radius: 10px; padding: 20px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);">
                            <h3 class="fw-bold"><i class="fas fa-cookie-bite"></i> Nuestros Productos Artesanales</h3>
                            <p class="mb-0">Galletas Trio, Conitos de Higo y Galletones de Papaya - Hechos a Mano</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="{% static 'img/carousel/lilis-productos-2.jpg' %}" class="d-block w-100" alt="Alfajores Lilis" style="height: 450px; object-fit: cover;">
                        <div class="carousel-caption d-none d-md-block" style="background: linear-gradient(to top, rgba(220, 38, 38, 0.9), rgba(220, 38, 38, 0.7)); border-radius: 10px; padding: 20px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);">
                            <h3 class="fw-bold"><i class="fas fa-heart"></i> Alfajores Premium</h3>
                            <p class="mb-0">Dulzura tradicional chilena con ingredientes de calidad</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="{% static 'img/carousel/lilis-productos-3.jpg' %}" class="d-block w-100" alt="Variedad Lilis" style="height: 450px; object-fit: cover;">
                        <div class="carousel-caption d-none d-md-block" style="background: linear-gradient(to top, rgba(220, 38, 38, 0.9), rgba(220, 38, 38, 0.7)); border-radius: 10px; padding: 20px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);">
                            <h3 class="fw-bold"><i class="fas fa-star"></i> Variedad de Sabores</h3>
                            <p class="mb-0">Desde galletas rellenas hasta deliciosos conitos bañados en chocolate</p>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Siguiente</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Botón Principal CRUD Productos -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); border: none; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="text-white">
                        <h4 class="mb-1">
                            <i class="fas fa-boxes"></i> Gestión de Productos
                        </h4>
                        <p class="mb-0">Accede al sistema completo de gestión de productos con todos tus datos de la base de datos</p>
                    </div>
                    <div>
                        <a href="{% url 'maestros:producto_listar' %}" class="btn btn-light btn-lg px-4 py-2 me-2" style="font-weight: bold;">
                            <i class="fas fa-list"></i> Ver Productos
                        </a>
                        {% if user|can_manage_products %}
                        <a href="{% url 'maestros:producto_crear' %}" class="btn btn-outline-light btn-lg px-4 py-2" style="border: 2px solid white; font-weight: bold;">
                            <i class="fas fa-plus"></i> Nuevo
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tarjetas de estadísticas -->
    <div class="row">
        <div class="col-md-3 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #991b1b 0%, #dc2626 100%); box-shadow: 0 4px 8px rgba(153, 27, 27, 0.3);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Carrito</h6>
                            <h2>{{ carrito_count }}</h2>
                        </div>
                        <div>
                            <i class="fas fa-shopping-cart fa-3x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%); box-shadow: 0 4px 8px rgba(185, 28, 28, 0.3);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Notificaciones</h6>
                            <h2>{{ notificaciones_count }}</h2>
                        </div>
                        <div>
                            <i class="fas fa-bell fa-3x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #7f1d1d 0%, #b91c1c 100%); box-shadow: 0 4px 8px rgba(127, 29, 29, 0.3);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Rol</h6>
                            <h6>{{ usuario.rol.nombre }}</h6>
                        </div>
                        <div>
                            <i class="fas fa-user-tag fa-3x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección de Cards de Módulos Principales -->
    <div class="row mb-4 justify-content-center">
        <div class="col-12 mb-3">
            <h4 class="text-center"><i class="fas fa-th-large"></i> Módulos del Sistema</h4>
        </div>
        
        <!-- Tarjeta 1: Ver Productos -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #dc2626; border-radius: 10px;">
                <img src="https://media.istockphoto.com/id/1524823226/es/foto/coloridas-frutas-y-verduras-crudas-variadas-comida-vegana-v%C3%ADvido-arreglo-de-arco-iris.jpg?s=2048x2048&w=is&k=20&c=V31zgnfuQciT2WmGZps8w9zTuc7xw0B5MMXgGoKHD3I=" 
                     class="card-img-top" alt="Productos" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-boxes text-danger"></i> Productos
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Gestiona el catálogo completo de productos, inventario, precios y categorías.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="{% url 'maestros:producto_listar' %}" class="btn btn-danger btn-lg">
                            <i class="fas fa-eye"></i> Ver Productos
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tarjeta 2: Ir a Ventas -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #dc2626; border-radius: 10px;">
                <img src="https://images.unsplash.com/photo-1556742111-a301076d9d18?w=400&h=200&fit=crop" 
                     class="card-img-top" alt="Ventas" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-shopping-cart text-danger"></i> Ventas
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Registra y controla todas las ventas, facturas y transacciones del negocio.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="#" class="btn btn-danger btn-lg">
                            <i class="fas fa-cash-register"></i> Ir a Ventas
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tarjeta 3: Configurar -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #dc2626; border-radius: 10px;">
                <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=400&h=200&fit=crop" 
                     class="card-img-top" alt="Configuración" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-cog text-danger"></i> Configuración
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Ajustes del sistema, usuarios, permisos y parámetros generales.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="{% url 'autenticacion:usuario_detalle' usuario.pk %}" class="btn btn-danger btn-lg">
                            <i class="fas fa-sliders-h"></i> Configurar
                        </a>
                    </div>
                </div>
            </div>
        </div>
        

        
        <!-- Tarjeta 5: Usuarios (Solo Admin) -->
        {% if user|is_admin %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #dc2626; border-radius: 10px;">
                <img src="https://images.unsplash.com/photo-1521791136064-7986c2920216?w=400&h=200&fit=crop" 
                     class="card-img-top" alt="Usuarios" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-users text-danger"></i> Usuarios
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Gestión de usuarios, roles, permisos y auditoría del sistema.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="{% url 'autenticacion:usuario_listar' %}" class="btn btn-danger btn-lg">
                            <i class="fas fa-users"></i> Gestionar Usuarios
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Tarjeta 6: Proveedores -->
        {% if user|can_manage_suppliers %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #dc2626; border-radius: 10px;">
                <img src="https://www.bankrate.com/2022/09/08173812/Real-estate-teams.jpg?auto=webp&crop=16%3A9&optimize=high" 
                     class="card-img-top" alt="Proveedores" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-truck text-danger"></i> Proveedores
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Gestión de proveedores, contratos y relaciones comerciales.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="{% url 'maestros:proveedor_listar' %}" class="btn btn-danger btn-lg">
                            <i class="fas fa-truck"></i> Ver Proveedores
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Tarjeta 7: Marcas -->
        {% if user|can_manage_products %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #2563eb; border-radius: 10px;">
                <img src="https://legismark.com/wp-content/uploads/2020/07/tipos-de-marcas-1.jpg" 
                     class="card-img-top" alt="Marcas" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-tag text-primary"></i> Marcas
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Administra las marcas de productos y su información comercial.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="{% url 'maestros:marca_listar' %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-tags"></i> Ver Marcas
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Tarjeta 8: Categorías -->
        {% if user|can_manage_products %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm" style="border-top: 4px solid #059669; border-radius: 10px;">
                <img src="https://thumbs.dreamstime.com/z/dulces-del-chocolate-16196384.jpg?ct=jpeg" 
                     class="card-img-top" alt="Categorías" style="height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center">
                        <i class="fas fa-sitemap text-success"></i> Categorías
                    </h5>
                    <p class="card-text text-center flex-grow-1">
                        Organiza productos por categorías y subcategorías del negocio.
                    </p>
                    <div class="d-grid gap-2 mt-auto">
                        <a href="{% url 'maestros:categoria_listar' %}" class="btn btn-success btn-lg">
                            <i class="fas fa-list-ul"></i> Ver Categorías
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Información del usuario -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header text-white" style="background-color: #dc2626;">
                    <h5 class="mb-0"><i class="fas fa-user-circle"></i> Mi Cuenta</h5>
                </div>
                <div class="card-body text-center">
                    <div class="mb-3">
                        <h5 class="mb-1">{{ usuario.get_full_name }}</h5>
                        <p class="text-muted mb-0">{{ usuario.rol.nombre }}</p>
                    </div>
                    <div class="d-grid">
                        <a href="{% url 'autenticacion:usuario_detalle' usuario.pk %}" class="btn text-white" style="background-color: #dc2626;">
                            <i class="fas fa-eye"></i> Ver Mi Perfil Completo
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header text-white" style="background-color: #dc2626;">
                    <h5 class="mb-0"><i class="fas fa-rocket"></i> Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        
                        <!-- Accesos rápidos para Maestros -->
                        {% if user|can_manage_inventory %}
                            <hr>
                            <h6 class="fw-bold">
                                <i class="fas fa-crown"></i> Gestión de Maestros
                            </h6>
                            <a href="{% url 'maestros:producto_listar' %}" class="btn btn-primary mb-2">
                                <i class="fas fa-boxes"></i> Gestión de Productos
                            </a>
                            
                            {% if user|can_manage_products %}
                            <a href="{% url 'maestros:producto_crear' %}" class="btn btn-primary mb-2">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </a>
                            {% endif %}
                            
                            <a href="{% url 'maestros:proveedor_listar' %}" class="btn btn-warning mb-2">
                                <i class="fas fa-truck"></i> Proveedores
                            </a>
                            
                            <!-- Accesos rápidos a Marcas -->
                            {% if user|can_manage_products %}
                            <a href="{% url 'maestros:marca_listar' %}" class="btn btn-info mb-2">
                                <i class="fas fa-tags"></i> Listar Marcas
                            </a>
                            <a href="{% url 'maestros:marca_crear' %}" class="btn btn-outline-info mb-2">
                                <i class="fas fa-plus"></i> Nueva Marca
                            </a>
                            {% endif %}
                            
                            <!-- Accesos rápidos a Categorías -->
                            {% if user|can_manage_products %}
                            <a href="{% url 'maestros:categoria_listar' %}" class="btn btn-success mb-2">
                                <i class="fas fa-list-ul"></i> Listar Categorías
                            </a>
                            <a href="{% url 'maestros:categoria_crear' %}" class="btn btn-outline-success">
                                <i class="fas fa-plus"></i> Nueva Categoría
                            </a>
                            {% endif %}
                        {% endif %}
                        
                        <!-- Accesos rápidos para Administración -->
                        {% if user|is_admin %}
                            <hr>
                            <h6 class="fw-bold">
                                <i class="fas fa-users-cog"></i> Administración
                            </h6>
                            <a href="{% url 'autenticacion:usuario_listar' %}" class="btn btn-primary mb-2">
                                <i class="fas fa-users"></i> Gestionar Usuarios
                            </a>
                        {% endif %}
                        
                        <hr>
                        <h6 class="text-muted">Sistema</h6>
                        <button onclick="mostrarCarrito()" class="btn btn-info">
                            <i class="fas fa-shopping-cart"></i> Ver Carrito
                        </button>
                        
                        <button onclick="mostrarNotificaciones()" class="btn btn-warning">
                            <i class="fas fa-bell"></i> Ver Notificaciones
                        </button>
                        
                        <button onclick="testNotification()" class="btn btn-secondary">
                            <i class="fas fa-vial"></i> Probar Notificación
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Resumen de actividad -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header text-white" style="background-color: #dc2626;">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Resumen de Actividad</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="p-3">
                                <i class="fas fa-boxes fa-2x mb-2 text-primary"></i>
                                <h4 class="mb-1 text-primary">{{ stats.productos_total }}</h4>
                                <p class="text-muted mb-0">Productos Activos</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3">
                                <i class="fas fa-exclamation-triangle fa-2x mb-2 text-warning"></i>
                                <h4 class="mb-1 text-warning">{{ stats.productos_bajo_stock }}</h4>
                                <p class="text-muted mb-0">Stock Bajo</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3">
                                <i class="fas fa-bell fa-2x mb-2 text-danger"></i>
                                <h4 class="mb-1 text-danger">{{ stats.alertas_pendientes }}</h4>
                                <p class="text-muted mb-0">Alertas Pendientes</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3">
                                <i class="fas fa-exchange-alt fa-2x mb-2 text-success"></i>
                                <h4 class="mb-1 text-success">{{ stats.movimientos_hoy }}</h4>
                                <p class="text-muted mb-0">Movimientos Hoy</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- Cierre container -->
</div> <!-- Cierre dashboard-container -->

{% endblock %}

{% block extra_js %}
<script>
    // Función para probar notificación
    function testNotification() {
        fetch('/api/notificaciones/agregar/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                titulo: 'Notificación de Prueba',
                mensaje: 'Esta es una notificación de prueba del sistema',
                tipo: 'info'
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Éxito!',
                    text: 'Notificación agregada correctamente',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000
                });
                actualizarContadores();
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    // Función para obtener cookie CSRF
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
{% endblock %}
